#include "catch.hpp"

#include "StubTiempoActual.h"
#include "../CoordinadorHilos.h"
#include "../Hilo.h"
#include "../Lambda.h"

SCENARIO("creacion de hilos", "[coordinador_hilos]") {
    GIVEN("un coordinador de hilos") {
        CoordinadorHilos* elCoordinador = new CoordinadorHilos();

        WHEN("se ejecuta código sin condiciones de tiempo") {
            bool ejecutado = false;
            auto codigo = comando(ejecutado = true);
            elCoordinador->agregarCodigo(codigo);
            
            THEN("el código se ejecuta cuando ejecuta el coordinador") {
                REQUIRE(!ejecutado);
                elCoordinador->ejecutar();
                REQUIRE(ejecutado);
            }
        }
        WHEN("se crea un nuevo hilo desde el coordinador") {
            Hilo* unHilo = elCoordinador->crearHilo();
            bool ejecutado = false;
            auto codigo = comando(ejecutado = true);
            unHilo->agregarCodigo(codigo);
            
            THEN("el código del hilo se ejecuta cuando ejecuta el coordinador") {
                REQUIRE(!ejecutado);
                elCoordinador->ejecutar();
                REQUIRE(ejecutado);
            }
        }
    }
}
